<!doctype html><html lang=en><head><meta charset=utf-8><meta name=referrer content="no-referrer"><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>canal-mysql binlogæ—¥å¿—è§£æ | mingzi.li blog</title><meta property="og:type" content="website"><meta property="og:title" content="canal-mysql binlogæ—¥å¿—è§£æ"><meta property="og:url" content="http://qiaomingzi.github.io/canal-mysql-binlog%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90/"><meta property="og:locale" content="en_GB"><meta property="og:image" content="http://qiaomingzi.github.io/images/og-image.png"><link rel=canonical href=http://qiaomingzi.github.io/canal-mysql-binlog%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90/><meta name=twitter:card content="summary"><meta name=twitter:site content="@p4lm"><link rel=stylesheet type=text/css href=/styles/main-bundle.108386b285ad502399f3a8ab890a333c177e59d922733a408892e466a7a87f70d143ace3585f247b62a75a780bd7bcff68b60fc6760b5ae1414e52c78fe708e7.css integrity media="screen, tv, projection"><link rel=stylesheet type=text/css href=/styles/print-bundle.f3d1ea3e2e864e24f7a26ff871aef6875b8e6246aad31fa6e63fdc9c91c629f6b4cdd7dca9beb3949f8b61a0db4c6fe8ec1bfc44ccf3a2cd9a91ea8e9eb20d44.css integrity media=print><link rel=preload as=font href=/fonts/muli1.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/muli2.woff2 type=font/woff2 crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#04396c><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.83.1"><svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="icon-arrow-right" viewBox="0 0 32 32"><path d="M19.414 27.414l10-10c.781-.781.781-2.047.0-2.828l-10-10c-.781-.781-2.047-.781-2.828.0s-.781 2.047.0 2.828L23.172 14H4c-1.105.0-2 .895-2 2s.895 2 2 2h19.172l-6.586 6.586c-.39.39-.586.902-.586 1.414s.195 1.024.586 1.414c.781.781 2.047.781 2.828.0z"/></symbol><symbol id="icon-arrow-left" viewBox="0 0 32 32"><path d="M12.586 27.414l-10-10c-.781-.781-.781-2.047.0-2.828l10-10c.781-.781 2.047-.781 2.828.0s.781 2.047.0 2.828L8.828 14H28c1.105.0 2 .895 2 2s-.895 2-2 2H8.828l6.586 6.586c.39.39.586.902.586 1.414s-.195 1.024-.586 1.414c-.781.781-2.047.781-2.828.0z"/></symbol><symbol id="icon-calendar" viewBox="0 0 32 32"><path d="M27.2 4.8h-1.6V8h-4.8V4.8h-9.6V8H6.4V4.8H4.8C3.038 4.8 1.6 6.24 1.6 8v19.2c0 1.76 1.438 3.2 3.2 3.2h22.4c1.76.0 3.2-1.44 3.2-3.2V8c0-1.76-1.44-3.2-3.2-3.2zm0 22.4H4.8V14.4h22.4v12.8zM10.4 1.6H7.2v5.6h3.2V1.6zm14.4.0h-3.2v5.6h3.2V1.6z"/></symbol><symbol id="icon-expand" viewBox="0 0 32 32"><path d="M11.179 17.579l-4.69 4.85-3.29-3.886v10.258h10.219l-3.888-3.33 4.848-4.691-3.2-3.2zM18.581 3.2l3.888 3.33-4.848 4.691 3.2 3.2 4.69-4.85 3.29 3.886V3.199H18.582z"/></symbol><symbol id="icon-collapse" viewBox="0 0 32 32"><path d="M6.56 22.56 1.6 27.2l3.2 3.2 4.64-4.96 3.36 3.36v-9.6H3.2l3.36 3.36zM30.4 4.8l-3.2-3.2-4.64 4.96L19.2 3.2v9.6h9.6l-3.36-3.36L30.4 4.8z"/></symbol><symbol id="icon-bubble" viewBox="0 0 32 32"><path d="M16 2c8.837.0 16 5.82 16 13s-7.163 13-16 13c-.849.0-1.682-.054-2.495-.158C10.068 31.279 5.966 31.895 2 31.986v-.841C4.142 30.096 6 28.184 6 26c0-.305-.024-.604-.068-.897-3.619-2.383-5.932-6.024-5.932-10.103.0-7.18 7.163-13 16-13z"/></symbol><symbol id="icon-folder" viewBox="0 0 32 32"><path d="M29.448 7.678C29.27 6.974 28.4 6.4 27.512 6.4H16.61c-.886.0-2.128-.509-2.755-1.131l-.954-.941c-.627-.622-1.867-1.128-2.754-1.128H4.939c-.888.0-1.694.715-1.792 1.59L2.68 9.6h27.09l-.322-1.922zM31.059 11.2h-30.118c-.547.0-.976.47-.923 1.016l1.477 15.47c.059.63.59 1.114 1.226 1.114h26.56c.635.0 1.165-.483 1.226-1.114l1.477-15.47c.053-.546-.376-1.016-.923-1.016z"/></symbol><symbol id="icon-tag" viewBox="0 0 32 32"><path d="M31.021.648c-.178-.502-.726-.768-1.23-.594s-.77.728-.595 1.232c1.486 4.272-1.464 7.462-3.714 9.171l-.909-1.302c-.306-.437-.989-.8-1.52-.806l-5.101.022c-.531-.01-1.32.234-1.755.541l-15.03 10.539c-.728.512-.904 1.515-.395 2.246l6.83 9.773c.512.728 1.33.64 2.059.131l15.03-10.541c.432-.306.931-.965 1.107-1.469l1.597-5.032c.176-.502.069-1.269-.237-1.706l-.554-.794c3.021-2.315 6.157-6.406 4.416-11.413zM24.027 15.621c-1.163.816-2.77.531-3.584-.634-.818-1.168-.533-2.774.632-3.594.925-.648 2.125-.602 2.989.027-.435.262-.734.416-.79.44-.482.229-.688.806-.461 1.288.166.35.514.557.875.557.138.0.278-.032.411-.094.31-.147.643-.322.99-.528.155.95-.222 1.947-1.062 2.538z"/></symbol><symbol id="icon-circle-with-cross" viewBox="0 0 32 32"><title>Close (Esc)</title><path d="M16 2.56C8.578 2.56 2.56 8.578 2.56 16S8.578 29.44 16 29.44 29.44 23.422 29.44 16 23.422 2.56 16 2.56zm7.662 18.338-2.766 2.766L16 18.766l-4.898 4.896-2.766-2.766L13.235 16l-4.898-4.898 2.766-2.765 4.896 4.896 4.898-4.898 2.766 2.766-4.899 4.898 4.898 4.898z"/></symbol></defs></svg></head><body x-data=window.blog :class="{ 'modal-open': isModalOpen, 'keyboard-navigation' : keyboardNavigation }" @mouseup="keyboardNavigation = false" @keydown.tab="keyboardNavigation = true" @keydown.escape=closeModals()><script>try{const a=window.localStorage.getItem('theme');a==='dark'&&document.querySelector('body').classList.add('dark'),a==='light'&&document.querySelector('body').classList.add('light')}catch(a){}</script><link rel=stylesheet type=text/css href=/styles/post-bundle.min.a3c415b51dea409e064708f705f91702ddddb4aaf1c7522073113ac5c6941f198ce5f39ea63cfaf21674b905146c1bdf3eeb0eaa41d22b9d013117c9bb72d81e.css integrity="sha512-o8QVtR3qQJ4GRwj3BfkXAt3dtKrxx1IgcxE6xcaUHxmM5fOepjz68hZ0uQUUbBvfPusOqkHSK50BMRfJu3LYHg==" media="screen, tv, projection"><div id=page-wrapper><header><svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="icon-home" viewBox="0 0 32 32"><path d="M32 18.451 16 6.031.0 18.451v-5.064l16-12.42 16 12.42zM28 18v12h-8v-8h-8v8H4V18l12-9z"/></symbol><symbol id="icon-user" viewBox="0 0 32 32"><path d="M18 22.082v-1.649c2.203-1.241 4-4.337 4-7.432.0-4.971.0-9-6-9s-6 4.029-6 9c0 3.096 1.797 6.191 4 7.432v1.649C7.216 22.637 2 25.97 2 30h28c0-4.03-5.216-7.364-12-7.918z"/></symbol><symbol id="icon-search" viewBox="0 0 32 32"><path d="M31.008 27.231l-7.58-6.447c-.784-.705-1.622-1.029-2.299-.998 1.789-2.096 2.87-4.815 2.87-7.787.0-6.627-5.373-12-12-12s-12 5.373-12 12 5.373 12 12 12c2.972.0 5.691-1.081 7.787-2.87-.031.677.293 1.515.998 2.299l6.447 7.58c1.104 1.226 2.907 1.33 4.007.23s.997-2.903-.23-4.007zM12 20c-4.418.0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"/></symbol></defs></svg><div class=header-content @click.away=menu.close()><div class=site-title>mingzi.li blog<span style=font-size:.5rem;margin-top:20px>&nbsp;&nbsp;è¡Œåˆ°æ°´ç©·å¤„ï¼Œåçœ‹é£äº‘èµ·</span></div><div class=theme-switcher :class="{'has-javascript': true}"><div class=switch><input type=checkbox name=toggle id=theme-switcher-indicator aria-label="Switch theme" @click=theme.toggleChanged($event.target) checked>
<label for=theme-switcher-indicator><i></i></label>
<span></span></div></div><a href=#content id=skip-link class=skip-link @click.prevent=skipLink.skipToContent($refs.content) @click.away=skipLink.removeContentTabIndex($refs.content)>Skip to content</a>
<button @click=menu.toggle() class=hamburger-trigger>Menu<div class=hamburger-menu><div class=bar :class="{'animate': menu.hamburgerIsOpen()}"></div></div></button><nav :class="{'open': menu.isOpen() || menu.isOpening(), 'open closing': menu.isClosing()}"><a href=/ class=home><svg class="icon icon-home"><use xlink:href="#icon-home"/></svg>é¦–é¡µ</a>
<a href=/about/ class=about><svg class="icon icon-user"><use xlink:href="#icon-user"/></svg>å…³äºæˆ‘</a>
<a href=/search-requires-javascript/ rel=nofollow class=search x-ref=searchMenuLink @click.prevent="menu.close(); search.open();$nextTick(() => $refs.searchInput.focus())"><svg class="icon icon-search"><use xlink:href="#icon-search"/></svg>æœç´¢</a></nav></div></header><div class=body><div class=body-max-width><main id=content x-ref=content><article class=full-article><h1>canal-mysql binlogæ—¥å¿—è§£æ</h1><div class=entry-meta><time class=published datetime="2021-10-16 15:42:33 +0000 UTC"><svg class="icon icon-calendar"><use xlink:href="#icon-calendar"/></svg>2021 October 16</time></div><div style=text-align:center;display:block;color:#999><div>æœ¬æ–‡ä»…ä¸ºä¸ªäººç¬”è®°,ä½œä¸ºå­¦ä¹ ä½¿ç”¨,å¦‚æœ‰é›·åŒè¯·è”ç³»ä½œè€… mingzi.li å¤„ç†,mail: qiaomingzi100@sina.com</div></div><h3 id=1å‚è€ƒ>1.å‚è€ƒ</h3><p>ã€alibaba canalã€‘https://github.com/alibaba/canal</p><p>ã€mysql binlogã€‘https://dev.mysql.com/doc/refman/8.0/en/binary-log.html</p><p>ã€mysql eventã€‘https://dev.mysql.com/doc/internals/en/event-meanings.html</p><p>ã€mysqlbinlog å‘½ä»¤ã€‘https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html</p><h3 id=2åŸºæœ¬ç®€ä»‹>2.åŸºæœ¬ç®€ä»‹</h3><p><strong>canal [kÉ™&rsquo;nÃ¦l]</strong>ï¼Œè¯‘æ„ä¸ºæ°´é“/ç®¡é“/æ²Ÿæ¸ ï¼Œä¸»è¦ç”¨é€”æ˜¯åŸºäº MySQL æ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…å’Œæ¶ˆè´¹</p><p><img src=./images/canal.png alt></p><h4 id=21-mysqlä¸»å¤‡å¤åˆ¶å®ç°>2.1 mysqlä¸»å¤‡å¤åˆ¶å®ç°</h4><p><img src=./images/mysql_syn.jfif alt></p><ol><li>masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­ï¼ˆè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œbinary log eventsï¼Œå¯ä»¥é€šè¿‡show binlog eventsè¿›è¡ŒæŸ¥çœ‹ï¼‰ï¼›</li><li>slaveå°†masterçš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)ï¼›</li><li>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚</li></ol><h4 id=22-mysql-binglog-æ•°æ®åŒ…æ ¼å¼>2.2 mysql binglog æ•°æ®åŒ…æ ¼å¼</h4><p><img src=./images/binlog_pack.png alt></p><p>mysql äº‹ä»¶ä½“ç›®å‰æœ‰ä¸€ä¸‹ç‰ˆæœ¬</p><ul><li><p>v1ï¼šåœ¨ MySQL 3.23 ä¸­ä½¿ç”¨</p><pre><code>+=====================================+
| event  | timestamp         0 : 4    |
| header +----------------------------+
|        | type_code         4 : 1    |
|        +----------------------------+
|        | server_id         5 : 4    |
|        +----------------------------+
|        | event_length      9 : 4    |
+=====================================+
| event  | fixed part       13 : y    |
| data   +----------------------------+
|        | variable part              |
+=====================================+

æ ‡å¤´é•¿åº¦ = 13 å­—èŠ‚
æ•°æ®é•¿åº¦ = (event_length - 13) å­—èŠ‚
y ç‰¹å®šäºäº‹ä»¶ç±»å‹ã€‚
</code></pre></li><li><p>v3ï¼šåœ¨ MySQL 4.0.2 åˆ° 4.1 ä¸­ä½¿ç”¨</p><pre><code>+=====================================+
| event  | timestamp         0 : 4    |
| header +----------------------------+
|        | type_code         4 : 1    |
|        +----------------------------+
|        | server_id         5 : 4    |
|        +----------------------------+
|        | event_length      9 : 4    |
|        +----------------------------+
|        | next_position    13 : 4    |
|        +----------------------------+
|        | flags            17 : 2    |
+=====================================+
| event  | fixed part       19 : y    |
| data   +----------------------------+
|        | variable part              |
+=====================================+

æ ‡å¤´é•¿åº¦ = 19 å­—èŠ‚
æ•°æ®é•¿åº¦ = (event_length - 19) å­—èŠ‚
y ç‰¹å®šäºäº‹ä»¶ç±»å‹ã€‚
</code></pre></li><li><p>v4ï¼šç”¨äº MySQL 5.0 åŠæ›´é«˜ç‰ˆæœ¬</p><pre><code>+=====================================+
| event  | timestamp         0 : 4    |
| header +----------------------------+
|        | type_code         4 : 1    |
|        +----------------------------+
|        | server_id         5 : 4    |
|        +----------------------------+
|        | event_length      9 : 4    |
|        +----------------------------+
|        | next_position    13 : 4    |
|        +----------------------------+
|        | flags            17 : 2    |
|        +----------------------------+
|        | extra_headers    19 : x-19 |
+=====================================+
| event  | fixed part        x : y    |
| data   +----------------------------+
|        | variable part              |
+=====================================+

æ ‡å¤´é•¿åº¦ = x å­—èŠ‚
æ•°æ®é•¿åº¦ = (event_length - x) å­—èŠ‚
å›ºå®šæ•°æ®é•¿åº¦ = y å­—èŠ‚å¯å˜æ•°æ®é•¿åº¦ = (event_length - (x + y)) å­—èŠ‚
</code></pre></li></ul><h4 id=22-canalå·¥ä½œåŸç†>2.2 canalå·¥ä½œåŸç†</h4><ol><li>canalæ¨¡æ‹Ÿmysql slaveçš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸ºmysql slaveï¼Œå‘mysql masterå‘é€dumpåè®®</li><li>mysql masteræ”¶åˆ°dumpè¯·æ±‚ï¼Œå¼€å§‹æ¨é€binary logç»™slave(ä¹Ÿå°±æ˜¯canal)</li><li>canalè§£æbinary logå¯¹è±¡(åŸå§‹ä¸ºbyteæµ)</li></ol><h4 id=23-canalæ¶æ„>2.3 canalæ¶æ„</h4><p><img src=./images/canal_construct.jfif alt></p><p>è¯´æ˜ï¼š</p><ul><li>serverä»£è¡¨ä¸€ä¸ªcanalè¿è¡Œå®ä¾‹ï¼Œå¯¹åº”äºä¸€ä¸ªjvm</li><li>instanceå¯¹åº”äºä¸€ä¸ªæ•°æ®é˜Ÿåˆ— ï¼ˆ1ä¸ªserverå¯¹åº”1..nä¸ªinstance)</li></ul><p>instanceæ¨¡å—ï¼š</p><ul><li><p>eventParser (æ•°æ®æºæ¥å…¥ï¼Œæ¨¡æ‹Ÿslaveåè®®å’Œmasterè¿›è¡Œäº¤äº’ï¼Œåè®®è§£æ)</p></li><li><p>eventSink (Parserå’ŒStoreé“¾æ¥å™¨ï¼Œè¿›è¡Œæ•°æ®è¿‡æ»¤ï¼ŒåŠ å·¥ï¼Œåˆ†å‘çš„å·¥ä½œ)</p></li><li><p>eventStore (æ•°æ®å­˜å‚¨)</p></li><li><p>metaManager (å¢é‡è®¢é˜…&æ¶ˆè´¹ä¿¡æ¯ç®¡ç†å™¨)</p></li></ul><h5 id=canal-instance>canal-instance</h5><p>instanceä»£è¡¨äº†ä¸€ä¸ªå®é™…è¿è¡Œçš„æ•°æ®é˜Ÿåˆ—ï¼ŒåŒ…æ‹¬äº†EventPaser,EventSink,EventStoreç­‰ç»„ä»¶ã€‚</p><p>æŠ½è±¡äº†CanalInstanceGeneratorï¼Œä¸»è¦æ˜¯è€ƒè™‘é…ç½®çš„ç®¡ç†æ–¹å¼ï¼š</p><ul><li>manageræ–¹å¼ï¼š å’Œä½ è‡ªå·±çš„å†…éƒ¨web console/managerç³»ç»Ÿè¿›è¡Œå¯¹æ¥ã€‚(ç›®å‰ä¸»è¦æ˜¯å…¬å¸å†…éƒ¨ä½¿ç”¨)</li><li>springæ–¹å¼ï¼šåŸºäºspring xml + propertiesè¿›è¡Œå®šä¹‰ï¼Œæ„å»ºspringé…ç½®.</li></ul><p><img src=./images/canal_instance.jfif alt></p><h5 id=canal-event-parser>canal-event-parser</h5><p>æ•´ä¸ªparserè¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºå‡ æ­¥ï¼š</p><ol><li>Connectionè·å–ä¸Šä¸€æ¬¡è§£ææˆåŠŸçš„ä½ç½® (å¦‚æœç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œåˆ™è·å–åˆå§‹æŒ‡å®šçš„ä½ç½®æˆ–è€…æ˜¯å½“å‰æ•°æ®åº“çš„binlogä½ç‚¹)</li><li>Connectionå»ºç«‹é“¾æ¥ï¼Œå‘é€BINLOG_DUMPæŒ‡ä»¤
// 0. write command number
// 1. write 4 bytes bin-log position to start at
// 2. write 2 bytes bin-log flags
// 3. write 4 bytes server id of the slave
// 4. write bin-log file name</li><li>Mysqlå¼€å§‹æ¨é€Binaly Log</li><li>æ¥æ”¶åˆ°çš„Binaly Logçš„é€šè¿‡Binlog parserè¿›è¡Œåè®®è§£æï¼Œè¡¥å……ä¸€äº›ç‰¹å®šä¿¡æ¯
// è¡¥å……å­—æ®µåå­—ï¼Œå­—æ®µç±»å‹ï¼Œä¸»é”®ä¿¡æ¯ï¼Œunsignedç±»å‹å¤„ç†</li><li>ä¼ é€’ç»™EventSinkæ¨¡å—è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Œç›´åˆ°å­˜å‚¨æˆåŠŸ</li><li>å­˜å‚¨æˆåŠŸåï¼Œå®šæ—¶è®°å½•Binaly Logä½ç½®</li></ol><p><img src=./images/canal_parse.jfif alt></p><h5 id=canal-event-sink>canal-event-sink</h5><p><img src=./images/canal-sink.jfif alt></p><p>è¯´æ˜ï¼š</p><ul><li>æ•°æ®è¿‡æ»¤ï¼šæ”¯æŒé€šé…ç¬¦çš„è¿‡æ»¤æ¨¡å¼ï¼Œè¡¨åï¼Œå­—æ®µå†…å®¹ç­‰</li><li>æ•°æ®è·¯ç”±/åˆ†å‘ï¼šè§£å†³1:n (1ä¸ªparserå¯¹åº”å¤šä¸ªstoreçš„æ¨¡å¼)</li><li>æ•°æ®å½’å¹¶ï¼šè§£å†³n:1 (å¤šä¸ªparserå¯¹åº”1ä¸ªstore)</li><li>æ•°æ®åŠ å·¥ï¼šåœ¨è¿›å…¥storeä¹‹å‰è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œæ¯”å¦‚join</li></ul><blockquote><p>æ•°æ®1:nä¸šåŠ¡</p></blockquote><blockquote><blockquote><p>ä¸ºäº†åˆç†çš„åˆ©ç”¨æ•°æ®åº“èµ„æºï¼Œ ä¸€èˆ¬å¸¸è§çš„ä¸šåŠ¡éƒ½æ˜¯æŒ‰ç…§schemaè¿›è¡Œéš”ç¦»ï¼Œç„¶ååœ¨mysqlä¸Šå±‚æˆ–è€…daoè¿™ä¸€å±‚é¢ä¸Šï¼Œè¿›è¡Œä¸€ä¸ªæ•°æ®æºè·¯ç”±ï¼Œå±è”½æ•°æ®åº“ç‰©ç†ä½ç½®å¯¹å¼€å‘çš„å½±å“ï¼Œé˜¿é‡Œç³»ä¸»è¦æ˜¯é€šè¿‡cobar/tddlæ¥è§£å†³æ•°æ®æºè·¯ç”±é—®é¢˜ã€‚</p></blockquote></blockquote><blockquote><blockquote><p>æ‰€ä»¥ï¼Œä¸€èˆ¬ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œä¼šéƒ¨ç½²å¤šä¸ªschemaï¼Œæ¯ä¸ªschemaä¼šæœ‰ç”±1ä¸ªæˆ–è€…å¤šä¸ªä¸šåŠ¡æ–¹å…³æ³¨</p></blockquote></blockquote><blockquote><p>æ•°æ®n:1ä¸šåŠ¡</p></blockquote><blockquote><blockquote><p>åŒæ ·ï¼Œå½“ä¸€ä¸ªä¸šåŠ¡çš„æ•°æ®è§„æ¨¡è¾¾åˆ°ä¸€å®šçš„é‡çº§åï¼Œå¿…ç„¶ä¼šæ¶‰åŠåˆ°æ°´å¹³æ‹†åˆ†å’Œå‚ç›´æ‹†åˆ†çš„é—®é¢˜ï¼Œé’ˆå¯¹è¿™äº›æ‹†åˆ†çš„æ•°æ®éœ€è¦å¤„ç†æ—¶ï¼Œå°±éœ€è¦é“¾æ¥å¤šä¸ªstoreè¿›è¡Œå¤„ç†ï¼Œæ¶ˆè´¹çš„ä½ç‚¹å°±ä¼šå˜æˆå¤šä»½ï¼Œè€Œä¸”æ•°æ®æ¶ˆè´¹çš„è¿›åº¦æ— æ³•å¾—åˆ°å°½å¯èƒ½æœ‰åºçš„ä¿è¯ã€‚</p></blockquote></blockquote><blockquote><blockquote><p>æ‰€ä»¥ï¼Œåœ¨ä¸€å®šä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œéœ€è¦å°†æ‹†åˆ†åçš„å¢é‡æ•°æ®è¿›è¡Œå½’å¹¶å¤„ç†ï¼Œæ¯”å¦‚æŒ‰ç…§æ—¶é—´æˆ³/å…¨å±€idè¿›è¡Œæ’åºå½’å¹¶.</p></blockquote></blockquote><h5 id=canal-event-store>canal-event-store</h5><ul><li>ç›®å‰ä»…å®ç°äº†Memoryå†…å­˜æ¨¡å¼ï¼Œåç»­è®¡åˆ’å¢åŠ æœ¬åœ°fileå­˜å‚¨ï¼Œmixedæ··åˆæ¨¡å¼</li><li>å€Ÿé‰´äº†Disruptorçš„RingBufferçš„å®ç°æ€è·¯</li></ul><p>RingBufferè®¾è®¡ï¼š</p><p><img src=./images/cannal-store.jfif alt></p><p>å®šä¹‰äº†3ä¸ªcursor</p><ul><li>Put : Sinkæ¨¡å—è¿›è¡Œæ•°æ®å­˜å‚¨çš„æœ€åä¸€æ¬¡å†™å…¥ä½ç½®</li><li>Get : æ•°æ®è®¢é˜…è·å–çš„æœ€åä¸€æ¬¡æå–ä½ç½®</li><li>Ack : æ•°æ®æ¶ˆè´¹æˆåŠŸçš„æœ€åä¸€æ¬¡æ¶ˆè´¹ä½ç½®</li></ul><p>å€Ÿé‰´Disruptorçš„RingBufferçš„å®ç°ï¼Œå°†RingBufferæ‹‰ç›´æ¥çœ‹ï¼š
<img src=./images/cannal-store_1.jfif alt=img></p><p>å®ç°è¯´æ˜ï¼š</p><ul><li>Put/Get/Ack cursorç”¨äºé€’å¢ï¼Œé‡‡ç”¨longå‹å­˜å‚¨</li><li>bufferçš„getæ“ä½œï¼Œé€šè¿‡å–ä½™æˆ–è€…ä¸æ“ä½œã€‚(ä¸æ“ä½œï¼š cusor & (size - 1) , sizeéœ€è¦ä¸º2çš„æŒ‡æ•°ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜)</li></ul><h4 id=24-canal-haè®¾è®¡>2.4 canal HAè®¾è®¡</h4><p><img src=./images/canal_ha.jfif alt></p><p>canalçš„haåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œcanal serverå’Œcanal clientåˆ†åˆ«æœ‰å¯¹åº”çš„haå®ç°</p><ul><li>canal server: ä¸ºäº†å‡å°‘å¯¹mysql dumpçš„è¯·æ±‚ï¼Œä¸åŒserverä¸Šçš„instanceè¦æ±‚åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¤„äºrunningï¼Œå…¶ä»–çš„å¤„äºstandbyçŠ¶æ€.</li><li>canal client: ä¸ºäº†ä¿è¯æœ‰åºæ€§ï¼Œä¸€ä»½instanceåŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªcanal clientè¿›è¡Œget/ack/rollbackæ“ä½œï¼Œå¦åˆ™å®¢æˆ·ç«¯æ¥æ”¶æ— æ³•ä¿è¯æœ‰åºã€‚</li></ul><p>æ•´ä¸ªHAæœºåˆ¶çš„æ§åˆ¶ä¸»è¦æ˜¯ä¾èµ–äº†zookeeperçš„å‡ ä¸ªç‰¹æ€§ï¼Œwatcherå’ŒEPHEMERALèŠ‚ç‚¹(å’Œsessionç”Ÿå‘½å‘¨æœŸç»‘å®š)ã€‚</p><p>å¤§è‡´æ­¥éª¤ï¼š</p><ol><li>canal serverè¦å¯åŠ¨æŸä¸ªcanal instanceæ—¶éƒ½å…ˆå‘zookeeperè¿›è¡Œä¸€æ¬¡å°è¯•å¯åŠ¨åˆ¤æ–­ (å®ç°ï¼šåˆ›å»ºEPHEMERALèŠ‚ç‚¹ï¼Œè°åˆ›å»ºæˆåŠŸå°±å…è®¸è°å¯åŠ¨)</li><li>åˆ›å»ºzookeeperèŠ‚ç‚¹æˆåŠŸåï¼Œå¯¹åº”çš„canal serverå°±å¯åŠ¨å¯¹åº”çš„canal instanceï¼Œæ²¡æœ‰åˆ›å»ºæˆåŠŸçš„canal instanceå°±ä¼šå¤„äºstandbyçŠ¶æ€</li><li>ä¸€æ—¦zookeeperå‘ç°canal server Aåˆ›å»ºçš„èŠ‚ç‚¹æ¶ˆå¤±åï¼Œç«‹å³é€šçŸ¥å…¶ä»–çš„canal serverå†æ¬¡è¿›è¡Œæ­¥éª¤1çš„æ“ä½œï¼Œé‡æ–°é€‰å‡ºä¸€ä¸ªcanal serverå¯åŠ¨instance.</li><li>canal clientæ¯æ¬¡è¿›è¡Œconnectæ—¶ï¼Œä¼šé¦–å…ˆå‘zookeeperè¯¢é—®å½“å‰æ˜¯è°å¯åŠ¨äº†canal instanceï¼Œç„¶åå’Œå…¶å»ºç«‹é“¾æ¥ï¼Œä¸€æ—¦é“¾æ¥ä¸å¯ç”¨ï¼Œä¼šé‡æ–°å°è¯•connect.</li></ol><p>Canal Clientçš„æ–¹å¼å’Œcanal serveræ–¹å¼ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨zookeeperçš„æŠ¢å EPHEMERALèŠ‚ç‚¹çš„æ–¹å¼è¿›è¡Œæ§åˆ¶.</p><h4 id=25-canal-client>2.5 canal client</h4><h5 id=client-serveräº¤äº’>client-serveräº¤äº’</h5><p><img src=./images/canal-protobuf.jfif alt></p><p>get/ack/rollbackåè®®ä»‹ç»ï¼š</p><ul><li>Message getWithoutAck(int batchSize)ï¼Œå…è®¸æŒ‡å®šbatchSizeï¼Œä¸€æ¬¡å¯ä»¥è·å–å¤šæ¡ï¼Œæ¯æ¬¡è¿”å›çš„å¯¹è±¡ä¸ºMessageï¼ŒåŒ…å«çš„å†…å®¹ä¸ºï¼š
a. batch id å”¯ä¸€æ ‡è¯†
b. entries å…·ä½“çš„æ•°æ®å¯¹è±¡ï¼Œå¯¹åº”çš„æ•°æ®å¯¹è±¡æ ¼å¼ï¼š<a href=https://github.com/alibaba/canal/blob/master/protocol/src/main/java/com/alibaba/otter/canal/protocol/EntryProtocol.proto>EntryProtocol.proto</a></li><li>void rollback(long batchId)ï¼Œé¡¾å‘½æ€è®®ï¼Œå›æ»šä¸Šæ¬¡çš„getè¯·æ±‚ï¼Œé‡æ–°è·å–æ•°æ®ã€‚åŸºäºgetè·å–çš„batchIdè¿›è¡Œæäº¤ï¼Œé¿å…è¯¯æ“ä½œ</li><li>void ack(long batchId)ï¼Œé¡¾å‘½æ€è®®ï¼Œç¡®è®¤å·²ç»æ¶ˆè´¹æˆåŠŸï¼Œé€šçŸ¥serveråˆ é™¤æ•°æ®ã€‚åŸºäºgetè·å–çš„batchIdè¿›è¡Œæäº¤ï¼Œé¿å…è¯¯æ“ä½œ</li></ul><p>canalçš„get/ack/rollbackåè®®å’Œå¸¸è§„çš„jmsåè®®æœ‰æ‰€ä¸åŒï¼Œå…è®¸get/ackå¼‚æ­¥å¤„ç†ï¼Œæ¯”å¦‚å¯ä»¥è¿ç»­è°ƒç”¨getå¤šæ¬¡ï¼Œåç»­å¼‚æ­¥æŒ‰é¡ºåºæäº¤ack/rollbackï¼Œé¡¹ç›®ä¸­ç§°ä¹‹ä¸ºæµå¼api.</p><p>æµå¼apiè®¾è®¡çš„å¥½å¤„ï¼š</p><ul><li>get/ackå¼‚æ­¥åŒ–ï¼Œå‡å°‘å› ackå¸¦æ¥çš„ç½‘ç»œå»¶è¿Ÿå’Œæ“ä½œæˆæœ¬ (99%çš„çŠ¶æ€éƒ½æ˜¯å¤„äºæ­£å¸¸çŠ¶æ€ï¼Œå¼‚å¸¸çš„rollbackå±äºä¸ªåˆ«æƒ…å†µï¼Œæ²¡å¿…è¦ä¸ºä¸ªåˆ«çš„caseç‰ºç‰²æ•´ä¸ªæ€§èƒ½)</li><li>getè·å–æ•°æ®åï¼Œä¸šåŠ¡æ¶ˆè´¹å­˜åœ¨ç“¶é¢ˆæˆ–è€…éœ€è¦å¤šè¿›ç¨‹/å¤šçº¿ç¨‹æ¶ˆè´¹æ—¶ï¼Œå¯ä»¥ä¸åœçš„è½®è¯¢getæ•°æ®ï¼Œä¸åœçš„å¾€åå‘é€ä»»åŠ¡ï¼Œæé«˜å¹¶è¡ŒåŒ–. (ä½œè€…åœ¨å®é™…ä¸šåŠ¡ä¸­çš„ä¸€ä¸ªcaseï¼šä¸šåŠ¡æ•°æ®æ¶ˆè´¹éœ€è¦è·¨ä¸­ç¾ç½‘ç»œï¼Œæ‰€ä»¥ä¸€æ¬¡æ“ä½œåŸºæœ¬åœ¨200msä»¥ä¸Šï¼Œä¸ºäº†å‡å°‘å»¶è¿Ÿï¼Œæ‰€ä»¥éœ€è¦å®æ–½å¹¶è¡ŒåŒ–)</li></ul><p>æµå¼apiè®¾è®¡ï¼š</p><p><img src=./images/canal-stream-api.jfif alt></p><ul><li>æ¯æ¬¡getæ“ä½œéƒ½ä¼šåœ¨metaä¸­äº§ç”Ÿä¸€ä¸ªmarkï¼Œmarkæ ‡è®°ä¼šé€’å¢ï¼Œä¿è¯è¿è¡Œè¿‡ç¨‹ä¸­markçš„å”¯ä¸€æ€§</li><li>æ¯æ¬¡çš„getæ“ä½œï¼Œéƒ½ä¼šåœ¨ä¸Šä¸€æ¬¡çš„markæ“ä½œè®°å½•çš„cursorç»§ç»­å¾€åå–ï¼Œå¦‚æœmarkä¸å­˜åœ¨ï¼Œåˆ™åœ¨last ack cursorç»§ç»­å¾€åå–</li><li>è¿›è¡Œackæ—¶ï¼Œéœ€è¦æŒ‰ç…§markçš„é¡ºåºè¿›è¡Œæ•°åºackï¼Œä¸èƒ½è·³è·ƒack. ackä¼šåˆ é™¤å½“å‰çš„markæ ‡è®°ï¼Œå¹¶å°†å¯¹åº”çš„markä½ç½®æ›´æ–°ä¸ºlast ack cusor</li><li>ä¸€æ—¦å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå®¢æˆ·ç«¯å¯å‘èµ·rollbackæƒ…å†µï¼Œé‡æ–°ç½®ä½ï¼šåˆ é™¤æ‰€æœ‰çš„mark, æ¸…ç†getè¯·æ±‚ä½ç½®ï¼Œä¸‹æ¬¡è¯·æ±‚ä¼šä»last ack cursorç»§ç»­å¾€åå–</li></ul><h5 id=æ•°æ®å¯¹è±¡æ ¼å¼>æ•°æ®å¯¹è±¡æ ¼å¼</h5><pre><code>Entry
	Header
		logfileName [binlogæ–‡ä»¶å]
		logfileOffset [binlog position]
		executeTime [binlogé‡Œè®°å½•å˜æ›´å‘ç”Ÿçš„æ—¶é—´æˆ³]
		schemaName [æ•°æ®åº“å®ä¾‹]
		tableName [è¡¨å]
		eventType [insert/update/deleteç±»å‹]
	entryType 	[äº‹åŠ¡å¤´BEGIN/äº‹åŠ¡å°¾END/æ•°æ®ROWDATA]
	storeValue 	[byteæ•°æ®,å¯å±•å¼€ï¼Œå¯¹åº”çš„ç±»å‹ä¸ºRowChange]
	
	
RowChange
  isDdl		[æ˜¯å¦æ˜¯ddlå˜æ›´æ“ä½œï¼Œæ¯”å¦‚create table/drop table]
  sql		[å…·ä½“çš„ddl sql]
  rowDatas	[å…·ä½“insert/update/deleteçš„å˜æ›´æ•°æ®ï¼Œå¯ä¸ºå¤šæ¡ï¼Œ1ä¸ªbinlog eventäº‹ä»¶å¯å¯¹åº”å¤šæ¡å˜æ›´ï¼Œæ¯”å¦‚æ‰¹å¤„ç†]
  beforeColumns [Columnç±»å‹çš„æ•°ç»„]
  afterColumns [Columnç±»å‹çš„æ•°ç»„]


Column
  index		[columnåºå·]
  sqlType		[jdbc type]
  name		[column name]
  isKey		[æ˜¯å¦ä¸ºä¸»é”®]
  updated		[æ˜¯å¦å‘ç”Ÿè¿‡å˜æ›´]
  isNull		[å€¼æ˜¯å¦ä¸ºnull]
  value		[å…·ä½“çš„å†…å®¹ï¼Œæ³¨æ„ä¸ºæ–‡æœ¬]
</code></pre><p>è¯´æ˜ï¼š</p><ul><li>å¯ä»¥æä¾›æ•°æ®åº“å˜æ›´å‰å’Œå˜æ›´åçš„å­—æ®µå†…å®¹ï¼Œé’ˆå¯¹binlogä¸­æ²¡æœ‰çš„name,isKeyç­‰ä¿¡æ¯è¿›è¡Œè¡¥å…¨</li><li>å¯ä»¥æä¾›ddlçš„å˜æ›´è¯­å¥</li></ul><h3 id=3cannel-æºç >3.cannel æºç </h3><h4 id=31-canalå¯åŠ¨>3.1 canalå¯åŠ¨</h4><pre><code>public void start() {
        super.start();

        if (!embeddedServer.isStart()) {
            embeddedServer.start();
        }
        //1.åˆ›å»ºcanal server
        this.bootstrap = new ServerBootstrap(new NioServerSocketChannelFactory(Executors.newCachedThreadPool(),
            Executors.newCachedThreadPool()));
        bootstrap.setOption(&quot;child.keepAlive&quot;, true);
        bootstrap.setOption(&quot;child.tcpNoDelay&quot;, true);

        //2.æ„é€ å¯¹åº”çš„pipeline
        bootstrap.setPipelineFactory(() -&gt; {
            ChannelPipeline pipelines = Channels.pipeline();
            pipelines.addLast(FixedHeaderFrameDecoder.class.getName(), new FixedHeaderFrameDecoder());
            // support to maintain child socket channel.
            pipelines.addLast(HandshakeInitializationHandler.class.getName(),
                new HandshakeInitializationHandler(childGroups));
            pipelines.addLast(ClientAuthenticationHandler.class.getName(),
                new ClientAuthenticationHandler(embeddedServer));
            //ä¼šè¯å¤„ç†
            SessionHandler sessionHandler = new SessionHandler(embeddedServer);
            pipelines.addLast(SessionHandler.class.getName(), sessionHandler);
            return pipelines;
        });

        //3.å¯åŠ¨ é»˜è®¤ç›‘å¬1111ç«¯å£
        if (StringUtils.isNotEmpty(ip)) {
            this.serverChannel = bootstrap.bind(new InetSocketAddress(this.ip, this.port));
        } else {
            this.serverChannel = bootstrap.bind(new InetSocketAddress(this.port));
        }
    }
</code></pre><pre><code>  public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception {
        ChannelBuffer buffer = (ChannelBuffer) e.getMessage();
        Packet packet = Packet.parseFrom(buffer.readBytes(buffer.readableBytes()).array());
        ClientIdentity clientIdentity = null;
       
            switch (packet.getType()) {
                case SUBSCRIPTION:
                    
                    break;
                case UNSUBSCRIPTION:
                     
                    break;
                case GET:
                    
                    break;
                case CLIENTACK:
                
                    break;
                case CLIENTROLLBACK:
                     
                    break;
                default:
                   
                    break;
            }
    }
</code></pre><h4 id=32-clientä»£ç >3.2 clientä»£ç </h4><p><img src=./images/client_src.png alt></p><h5 id=321-è®¢é˜…æ•°æ®-socket>3.2.1 è®¢é˜…æ•°æ®-socket</h5><pre><code>public static void main(String args[]) {
    // åˆ›å»ºé“¾æ¥
    CanalConnector connector = CanalConnectors.newSingleConnector(new InetSocketAddress(AddressUtils.getHostIp(),11111), &quot;example&quot;, &quot;&quot;, &quot;&quot;);
    int batchSize = 1000; 
    try {
        connector.connect();
        connector.subscribe(&quot;.*\\..*&quot;);
        connector.rollback(); 
        while (isRunning) {
             // è·å–æŒ‡å®šæ•°é‡çš„æ•°æ®
            Message message = connector.getWithoutAck(batchSize);
            long batchId = message.getId();
            int size = message.getEntries().size();
            if(size &gt; 0){
              printEntry(batchId,message.getEntries());
            }
            // æäº¤ç¡®è®¤
            connector.ack(batchId); 
            // å¤„ç†å¤±è´¥, å›æ»šæ•°æ®
            // connector.rollback(batchId); 
        }
    } finally {
        connector.disconnect();
    }
}

private static void printEntry(long batchId,List&lt;Entry&gt; entrys) {
    for (Entry entry : entrys) {
        if (entry.getEntryType() == EntryType.TRANSACTIONBEGIN || entry.getEntryType() == EntryType.TRANSACTIONEND) {
            continue;
        }
        //æ•°æ®ååºåˆ—åŒ–
        RowChange  rowChage = RowChange.parseFrom(entry.getStoreValue());
        EventType eventType = rowChage.getEventType();
        for (RowData rowData : rowChage.getRowDatasList()) {
            if (eventType == EventType.DELETE) {
                printColumn(rowData.getBeforeColumnsList());
            } else if (eventType == EventType.INSERT) {
                printColumn(rowData.getAfterColumnsList());
            } else {
                System.out.println(&quot;-------&amp;gt; before&quot;);
                printColumn(rowData.getBeforeColumnsList());
                System.out.println(&quot;-------&amp;gt; after&quot;);
                printColumn(rowData.getAfterColumnsList());
            }
        }
    }
}

private static void printColumn(List&lt;Column&gt; columns) {
    for (Column column : columns) {
        System.out.println(column.getName() + &quot; : &quot; + column.getValue() + &quot;    update=&quot; + column.getUpdated());
    }
}
</code></pre><h5 id=322-è¿æ¥canal-server>3.2.2 è¿æ¥canal server</h5><pre><code>private InetSocketAddress doConnect() throws CanalClientException {
        try {
            channel = SocketChannel.open();
            channel.socket().setSoTimeout(soTimeout);
            SocketAddress address = getAddress();
            if (address == null) {
                address = getNextAddress();
            }
            //1.è¿æ¥ server
            channel.connect(address);
            //è¯»channel
            readableChannel = Channels.newChannel(channel.socket().getInputStream());
            //å†™channel
            writableChannel = Channels.newChannel(channel.socket().getOutputStream());
            //2.æ¡æ‰‹
            Packet p = Packet.parseFrom(readNextPacket());
            if (p.getVersion() != 1) {
                throw new CanalClientException(&quot;unsupported version at this client.&quot;);
            }

            if (p.getType() != PacketType.HANDSHAKE) {
                throw new CanalClientException(&quot;expect handshake but found other type.&quot;);
            }
            Handshake handshake = Handshake.parseFrom(p.getBody());
            supportedCompressions.add(handshake.getSupportedCompressions());
            //
            ByteString seed = handshake.getSeeds(); // seed for auth
            String newPasswd = password;
            if (password != null) {
                // encode passwd
                newPasswd = SecurityUtil.byte2HexStr(SecurityUtil.scramble411(password.getBytes(), seed.toByteArray()));
            }

            ClientAuth ca = ClientAuth.newBuilder()
                .setUsername(username != null ? username : &quot;&quot;)
                .setPassword(ByteString.copyFromUtf8(newPasswd != null ? newPasswd : &quot;&quot;))
                .setNetReadTimeout(idleTimeout)
                .setNetWriteTimeout(idleTimeout)
                .build();
            //3.é‰´æƒå®¢æˆ·ç«¯
            writeWithHeader(Packet.newBuilder()
                .setType(PacketType.CLIENTAUTHENTICATION)
                .setBody(ca.toByteString())
                .build()
                .toByteArray());
            //4.è¿æ¥æˆç¡®è®¤
            Packet ack = Packet.parseFrom(readNextPacket());
            if (ack.getType() != PacketType.ACK) {
                throw new CanalClientException(&quot;unexpected packet type when ack is expected&quot;);
            }

            Ack ackBody = Ack.parseFrom(ack.getBody());
            if (ackBody.getErrorCode() &gt; 0) {
                throw new CanalClientException(&quot;something goes wrong when doing authentication: &quot;
                                               + ackBody.getErrorMessage());
            }

            connected = true;
            return new InetSocketAddress(channel.socket().getLocalAddress(), channel.socket().getLocalPort());
        } catch (IOException | NoSuchAlgorithmException e) {
            throw new CanalClientException(e);
        }
    }
</code></pre><footer><section class=categories-tags><span><svg class="icon icon-folder"><use xlink:href="#icon-folder"/></svg><span class=screen-reader-text>This entry was posted in</span>
<a href=/categories/java>java</a></span> <span><svg class="icon icon-tag"><use xlink:href="#icon-tag"/></svg><a class=article-tags href=/tags/canal>canal</a></span></section></footer><div id=comments-button-container class=comments-button-container><button type=button onclick=loadDisqus() class=comments-button><svg class="icon icon-bubble"><use xlink:href="#icon-bubble"/></svg> <span>Show Comments</span></button></div><div id=disqus_thread></div><script type=text/javascript>function loadDisqus(){var a,b;document.getElementById('comments-button-container').style.display='none',a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='ææ˜æ¢“',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)}</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><aside id=sidebar><div class=widget><div class=widget-title>Recent posts</div><ol class="recent-widget widget-content"><li><a href=/%E4%BD%8D%E8%BF%90%E7%AE%97%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>ä½è¿ç®—åŸºç¡€çŸ¥è¯†</a></li><li><a href=/go-36%E8%AE%B2/>GO 36è®²</a></li><li><a href=/maven-wrapper%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/>maven-wrapperåŸºç¡€ä½¿ç”¨</a></li><li><a href=/mysql-master-slave/>mysql master-slave</a></li><li><a href=/sonarqube%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/>sonarqubeåŸºç¡€ä½¿ç”¨</a></li></ol></div><div class=widget><div class=widget-title>Categories</div><ol class="all-categories widget-content"><li><a href=/categories/devops>devops</a> (1)</li><li><a href=/categories/java>java</a> (4)</li><li><a href=/categories/mysql>mysql</a> (1)</li><li><a href=/categories/%E5%85%B6%E4%BB%96>å…¶ä»–</a> (4)</li><li><a href=/categories/%E5%89%8D%E7%AB%AF>å‰ç«¯</a> (1)</li><li><a href=/categories/%E5%90%8E%E7%AB%AF>åç«¯</a> (1)</li><li><a href=/categories/%E5%9F%BA%E7%A1%80>åŸºç¡€</a> (1)</li><li><a href=/categories/%E5%B7%A5%E5%85%B7>å·¥å…·</a> (2)</li></ol></div><div class=widget><div class=widget-title>Tags</div><div class="tag-cloud-tags widget-content"><a href=/tags/canal aria-label="canal (2 posts)" style=font-size:1rem>canal</a>
<a href=/tags/git aria-label="git (1 posts)" style=font-size:1rem>git</a>
<a href=/tags/go aria-label="go (1 posts)" style=font-size:1rem>go</a>
<a href=/tags/hexo aria-label="hexo (1 posts)" style=font-size:1rem>hexo</a>
<a href=/tags/java aria-label="java (1 posts)" style=font-size:1rem>java</a>
<a href=/tags/maven aria-label="maven (1 posts)" style=font-size:1rem>maven</a>
<a href=/tags/mysql aria-label="mysql (1 posts)" style=font-size:1rem>mysql</a>
<a href=/tags/yarn aria-label="yarn (1 posts)" style=font-size:1rem>yarn</a>
<a href=/tags/zabbix aria-label="zabbix (1 posts)" style=font-size:1rem>zabbix</a>
<a href=/tags/%E5%9F%BA%E7%A1%80 aria-label="åŸºç¡€ (1 posts)" style=font-size:1rem>åŸºç¡€</a>
<a href=/tags/%E5%B7%A5%E5%85%B7 aria-label="å·¥å…· (1 posts)" style=font-size:1rem>å·¥å…·</a>
<a href=/tags/%E8%BD%AF%E6%96%87%E6%94%B6%E9%9B%86 aria-label="è½¯æ–‡æ”¶é›† (2 posts)" style=font-size:1rem>è½¯æ–‡æ”¶é›†</a></div></div></aside></div></div><svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="icon-github" viewBox="0 0 32 32"><path d="M16 .395c-8.836.0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182.8.148 1.094-.347 1.094-.77.0-.381-.015-1.642-.022-2.979-4.452.968-5.391-1.888-5.391-1.888-.728-1.849-1.776-2.341-1.776-2.341-1.452-.993.11-.973.11-.973 1.606.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33.143-1.034.558-1.74 1.016-2.14-3.554-.404-7.29-1.777-7.29-7.907.0-1.747.625-3.174 1.649-4.295-.166-.403-.714-2.03.155-4.234.0.0 1.344-.43 4.401 1.64 1.276-.355 2.645-.532 4.005-.539 1.359.006 2.729.184 4.008.539 3.054-2.07 4.395-1.64 4.395-1.64.871 2.204.323 3.831.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295.0 6.145-3.743 7.498-7.306 7.895.574.497 1.085 1.47 1.085 2.963.0 2.141-.019 3.864-.019 4.391.0.426.288.925 1.099.768C27.421 29.457 32 23.462 32 16.395c0-8.837-7.164-16-16-16z"/></symbol><symbol id="icon-arrow-with-circle-up" viewBox="0 0 32 32"><path d="M16 .64C7.515.64.638 7.517.638 16c0 8.485 6.877 15.362 15.362 15.362 8.482.0 15.36-6.877 15.36-15.362.0-8.483-6.878-15.36-15.36-15.36zM15.998 28.16c-6.715.0-12.16-5.443-12.16-12.16S9.281 3.84 15.998 3.84 28.16 9.285 28.16 16s-5.446 12.16-12.162 12.16zM16 8.8l7.2 7.2h-4v6.4h-6.4V16h-4L16 8.8z"/></symbol></defs></svg><footer id=page-footer><div class=footer-content><a href=https://github.com/qiaomingzi/limz-blog-hugo target=_blank rel=noopener title="Source Code for this Blog"><div class=footer-text><svg class="icon icon-github"><use xlink:href="#icon-github"/></svg>Blog code</div></a><a href=#page-wrapper title="Go to top" id=go-to-top-link><div class=footer-text>To top<svg class="icon icon-arrow-with-circle-up"><use xlink:href="#icon-arrow-with-circle-up"/></svg></div></a><script>document.getElementById("go-to-top-link").onclick=function(){return window.scroll(0,0),!1}</script></div></footer></div><div id=lightbox-container :class="{'open': lightbox.isOpen, 'close': !lightbox.isOpen}"><button type=button aria-label="Close image modal" class=modal-close-button @click=lightbox.close()><svg class="icon icon-circle-with-cross"><use xlink:href="#icon-circle-with-cross"/></svg>
(ESC)</button><div id=lightbox-loading-container x-ref=lightboxLoadingContainer x-show=lightbox.showLoading><div id=lightbox-loading><div aria-busy=true aria-label="Loading, please wait." role=progressbar class=spinner @click=lightbox.cancel() @click.away=lightbox.cancel()></div></div></div><div id=lightbox x-ref=lightbox :class="{'open': lightbox.openImage, 'close': !lightbox.openImage}" @click=lightbox.close()></div></div><div id=code-container :class="{'open': code.isOpening, 'close': !code.isOpening}"><button class=modal-close-button><svg class="icon icon-circle-with-cross"><use xlink:href="#icon-circle-with-cross"/></svg>
(ESC)</button><div id=code-container-inner class=close :class="{'open': code.isOpening, 'close': !code.isOpening}"><div class=box-shadow-container @click.away=code.close()><div id=code-placeholder></div></div></div></div><div id=searchbox-container :class="{'open': search.isOpen}" x-show=search.isOpen x-on:keydown.escape="$nextTick(() => $refs.searchMenuLink.focus())"><button type=button aria-label="Close search modal" class=modal-close-button @click="search.close();$nextTick(() => $refs.searchMenuLink.focus())"><svg class="icon icon-circle-with-cross"><use xlink:href="#icon-circle-with-cross"/></svg>
(ESC)</button><div id=searchbox :class="{'open': search.isOpen}"><svg class="icon icon-search"><use xlink:href="#icon-search"/></svg><label for=search-input class=sr-only>Searchbox</label>
<input id=search-input type=search placeholder=Search... class=search-input x-ref=searchInput autocomplete=off autocorrect=off autocapitalize=off spellcheck=false x-model=search.textInSearchBox x-on:input=search.searchBoxChanged($event.target.value) x-on:keydown.enter="search.focusFirstAnchor($event, $refs.hits)" x-on:keydown.arrow-down="search.focusFirstAnchor($event, $refs.hits)"><svg class="icon icon-circle-with-cross close-search" role="button" aria-label="Close search" @click="search.close();$nextTick(() => $refs.searchMenuLink.focus())"><use xlink:href="#icon-circle-with-cross"/></svg></div><div class=search-results-container><div id=search-output x-show=search.textInSearchBox><div id=no-results-message x-show="search.store && search.textInSearchBox && !search.hits.length">No matching posts found. You can use wildcards and search only in titles, e.g. <code>title:iot</code></div><div id=index-loading-message x-show="!search.indexLoadFailed && search.indexLoading && search.textInSearchBox"><span class=icon-spinner aria-hidden=true></span>Loading search index, please wait...</div><div id=index-failed-message x-show="search.indexLoadFailed && search.textInSearchBox">Search index failed to download ğŸ˜¢</div><div id=number-of-hits-message x-text=search.getHitsText() x-show=search.hits.length></div><ol class=result-list x-show=search.hits.length x-ref=hits><template x-for="hit in search.hits" :key=hit.ref><li><h2><a :href=hit.ref x-text=search.fromStore(hit).title></a></h2><div class=entry-meta><time class=published :datetime=search.fromStore(hit).dateiso><svg class="icon icon-calendar"><use xlink:href="#icon-calendar"/></svg><span x-text=search.fromStore(hit).dateformatted></span></time></div><p x-text=search.fromStore(hit).summary></p></li></template></ol></div></div></div><script src=/bundle.326b2331e4a76c824b17b8d379095b25394912a8f7f1c8a6162a06f763a2caabe6226dee31773ec698c47b06f1de9bb7133091e9260d4d95b4011c7351300442.js integrity="sha512-MmsjMeSnbIJLF7jTeQlbJTlJEqj38cimFioG92OiyqvmIm3uMXc+xpjEewbx3pu3EzCR6SYNTZW0ARxzUTAEQg=="></script></body></html>